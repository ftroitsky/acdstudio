!function(e){e.piroBox_ext=function(i){function o(){e(window).scroll(function(){var i=e(window).height(),o=e(window).width(),r=v.height()-20,a=v.width();v.css({left:o/2-a/2+"px",top:parseInt(e(document).scrollTop())+(i-r)/2+m})})}function r(){if(e(".piro_close").is(":visible")){e(".zoomIn").add(".zoomOut").add(".my_frame").add(".caption").remove(),v.add(div_reg).add(resize).stop(),1==i.piro_drag&&v.draggable({disabled:!1});var o=v;e.browser.msie?(o=div_reg.add(piro_bg),e(".div_reg img").remove()):o=v.add(piro_bg),o.piroFadeOut(200,function(){div_reg.html(""),piro_loader.hide(),piro_nav.hide(),piro_bg.add(v).hide().css("visibility","visible")})}}i=jQuery.extend({piro_speed:700,bg_alpha:.9,piro_scroll:!0,piro_drag:null,piro_nav_pos:"top"},i),e.fn.piroFadeIn=function(i,o){e(this).fadeIn(i,function(){jQuery.browser.msie&&e(this).get(0).style.removeAttribute("filter"),void 0!=o&&o()})},e.fn.piroFadeOut=function(i,o){e(this).fadeOut(i,function(){jQuery.browser.msie&&e(this).get(0).style.removeAttribute("filter"),void 0!=o&&o()})};for(var a=e('a[class*="pirobox"]'),t=new Object,d=0;d<a.length;d++){var s=e(a[d]);t["a."+s.attr("class").match(/^pirobox_gall\w*/)]=0}var n=new Array;for(var l in t)n.push(l);for(var d=0;d<n.length;d++)e(n[d]+":first").addClass("first"),e(n[d]+":last").addClass("last");var p=e(a);e('a[class*="pirobox_gall"]').each(function(e){this.rev=e+0}),1==e('a[class*="pirobox_gall"]').length&&e('a[class*="pirobox_gall"]').each(function(){e(this).addClass("single_fix")});var c='<div class="caption"></div>',_=.9,h='<div class="piro_overlay"></div><table class="piro_html"  cellpadding="0" cellspacing="0"><tr><td class="h_t_l"></td><td class="h_t_c" title="drag me!!"></td><td class="h_t_r"></td></tr><tr><td class="h_c_l"></td><td class="h_c_c"><div class="piro_loader" title="close"><span></span></div><div class="resize"><div class="nav_container"><a href="#prev" class="piro_prev" title="previous"></a><a href="#next" class="piro_next" title="next"></a><div class="piro_prev_fake">prev</div><div class="piro_next_fake">next</div><div class="piro_close" title="close"></div></div><div class="div_reg"></div></div></td><td class="h_c_r"></td></tr><tr><td class="h_b_l"></td><td class="h_b_c"></td><td class="h_b_r"></td></tr></table>';e("body").append(h);var v=e(".piro_html");if(piro_bg=e(".piro_overlay"),piro_nav=e(".nav_container"),piro_next=e(".piro_next"),piro_prev=e(".piro_prev"),piro_next_fake=e(".piro_next_fake"),piro_prev_fake=e(".piro_prev_fake"),piro_close=e(".piro_close"),div_reg=e(".div_reg"),piro_loader=e(".piro_loader"),resize=e(".resize"),y=e(window).height(),x=e(window).width(),piro_nav.hide().css(i.piro_nav_pos,"-38px"),"top"==i.piro_nav_pos)var m=5;else if("bottom"==i.piro_nav_pos)var m=-30;v.css({left:x/2-250+"px",top:parseInt(e(document).scrollTop())+100}),e(v).add(piro_bg).hide(),piro_bg.css({opacity:i.bg_alpha}),e(piro_prev).add(piro_next).bind("click",function(i){piro_nav.hide(),e(".caption").remove(),e(".zoomIn").add(".zoomOut").remove(),i.preventDefault(),piro_next.add(piro_prev).hide();var o=parseInt(e('a[class*="pirobox_gall"]').filter(".item").attr("rev")),r=e(this).is(".piro_prev")?e('a[class*="pirobox_gall"]').eq(o-1):e('a[class*="pirobox_gall"]').eq(o+1);r.click()}),e("html").bind("keyup",function(i){27==i.keyCode&&(i.preventDefault(),e(piro_close).is(":visible")&&r())}),e("html").bind("keyup",function(i){e(".item").is(".first")||("single"==e(".item").attr("rel")?piro_nav.show():37==i.keyCode&&(i.preventDefault(),e(piro_close).is(":visible")&&piro_prev.click()))}),e("html").bind("keyup",function(i){e(".item").is(".last")||("single"==e(".item").attr("rel")?piro_nav.show():39==i.keyCode&&(i.preventDefault(),e(piro_close).is(":visible")&&piro_next.click()))}),e(window).resize(function(){var i=e(window).height(),o=e(window).width(),r=v.height(),a=v.width();v.css({left:o/2-a/2+"px",top:parseInt(e(document).scrollTop())+(i-r)/2+m})}),1==i.piro_scroll&&o(),e(p).each(function(){function o(){function o(){e(".caption").remove(),"full"==a[1]&&"full"==a[2]&&(a[2]=e(window).height()-70,a[1]=e(window).width()-55);var o=e(window).height(),r=e(window).width();piro_close.hide(),div_reg.add(resize).animate({height:+a[2]+"px",width:+a[1]+"px"},i.piro_speed).css("visibility","visible"),v.animate({height:+a[2]+20+"px",width:+a[1]+20+"px",left:r/2-(a[1]/2+10)+"px",top:parseInt(e(document).scrollTop())+(o-a[2])/2+m},i.piro_speed,function(){piro_next.add(piro_prev).add(piro_prev_fake).add(piro_next_fake).css("visibility","visible"),piro_nav.show(),piro_close.show()})}function d(){piro_nav.add(".caption").hide(),""==r?e(".caption").remove():e(c).appendTo(resize);var o=new Image;o.onerror=function(){e(".caption").remove(),o.src="http://www.pirolab.it/pirobox/js/error.jpg"},o.onload=function(){var a=o.height,t=o.width,d=e(window).height(),s=e(window).width(),n=o.height,l=o.width;if(n+20>d||l+20>s){var p=(l+20)/s,c=(n+20)/d;c>p?(l=Math.round(o.width*(_/c)),n=Math.round(o.height*(_/c))):(l=Math.round(o.width*(_/p)),n=Math.round(o.height*(_/p))),e(".zoomIn").add(".zoomOut").remove(),e(".h_c_c").append('<a href="#" class="zoomIn" title="">zoomIn</a>'),e(".zoomIn,.zoomOut").hide()}else n=o.height,l=o.width,e(".zoomIn").add(".zoomOut").remove();var d=e(window).height(),s=e(window).width();e(o).height(n).width(l).hide(),e(".div_reg img").remove(),e(".div_reg").html(""),div_reg.append(o).show(),e(o).addClass("immagine"),1==i.piro_drag&&(e(".immagine,.h_b_c,.h_t_c").css("cursor","move"),e.browser.msie?v.draggable({handle:".h_t_c,.h_b_c,.div_reg img"}):v.draggable({handle:".h_t_c,.h_b_c,.div_reg img",opacity:.8})),div_reg.add(resize).animate({height:n+"px",width:l+"px"},i.piro_speed),v.animate({height:n+20+"px",width:l+20+"px",left:s/2-(l+20)/2+"px",top:parseInt(e(document).scrollTop())+(d-n)/2+m},i.piro_speed,function(){piro_loader.hide();var d=resize.width();e(".caption").css({width:d+"px"}),e(".caption").html("<p>"+r+"</p>").hide(),e(o).fadeIn(300,function(){"http://www.pirolab.it/pirobox/js/error.jpg"==o.src,e(window).scroll(function(){e(".zoomOut").is(":visible")&&e(o).animate({width:l,height:n,top:0,left:0},600,function(){e(".immagine").css("cursor","auto"),e(o).draggable({disabled:!0}),e(".zoomIn").add(".zoomOut").remove(),e(".h_c_c").append('<a href="#" class="zoomIn" title="">zoomIn</a>'),e(".zoomIn").show()})}),e(".zoomOut").live("click",function(r){r.preventDefault(),e(".immagine").css("cursor","auto"),1==i.piro_drag&&v.draggable({disabled:!1}),e(o).draggable({disabled:!0}),e(".zoomIn").add(".zoomOut").remove(),e(".h_c_c").append('<a href="#" class="zoomIn" title="">zoomIn</a>'),e(".zoomIn").show(),e(o).animate({width:l,height:n,top:0,left:0},600)}),e(".zoomIn").live("click",function(r){r.preventDefault(),e(".zoomIn").add(".zoomOut").remove(),e(".h_c_c").append('<a href="#" class="zoomOut" title="">zoomOut</a>'),e(".zoomOut").show(),1==i.piro_drag&&v.draggable({disabled:!0}),e(o).draggable({disabled:!1}),e(o).animate({width:t,height:a,top:-(a-n)/2,left:-(t-l)/2},600,function(){var i=div_reg.offset(),r=i.left+l-t,d=i.top+n-a,s=i.left,p=i.top;e(o).draggable({containment:[r,d,s,p],scrollSpeed:400}),e(".immagine").css("cursor","move")})}),e(".zoomIn").show(),piro_close.show(),e(".caption").slideDown(200),piro_next.add(piro_prev).add(piro_prev_fake).add(piro_next_fake).css("visibility","visible"),piro_nav.show(),resize.resize(function(){NimgW=o.width,NimgH=o.heigh,e(".caption").css({width:NimgW+"px"})})})})},o.src=t,piro_loader.click(function(){o.src="about:blank"})}switch(v.add(piro_bg).add(div_reg).add(piro_loader).show(),a[0]){case"iframe":e(".zoomIn").add(".zoomOut").remove(),div_reg.html("").css("overflow","hidden"),resize.css("overflow","hidden"),piro_close.hide(),o(),div_reg.piroFadeIn(300,function(){div_reg.append('<iframe id="my_frame" class="my_frame" src="'+t+'" frameborder="0" allowtransparency="true" scrolling="auto" align="top"></iframe>'),e(".my_frame").css({height:+a[2]+"px",width:+a[1]+"px"}),piro_loader.hide()});break;case"content":e(".zoomIn").add(".zoomOut").remove(),div_reg.html("").css("overflow","auto"),resize.css("overflow","auto"),e(".my_frame").remove(),piro_close.hide(),o(),div_reg.piroFadeIn(300,function(){div_reg.load(t),piro_loader.hide()});break;case"inline":e(".zoomIn").add(".zoomOut").remove(),div_reg.html("").css("overflow","auto"),resize.css("overflow","auto"),e(".my_frame").remove(),piro_close.hide(),o(),div_reg.piroFadeIn(300,function(){e(t).clone(!0).appendTo(div_reg).piroFadeIn(300),piro_loader.hide()});break;case"flash":e(".zoomIn").add(".zoomOut").remove(),e(".my_frame").remove(),div_reg.html("").css("overflow","hidden"),o();var s='<object  width="'+a[1]+'" height="'+a[2]+'"><param name="movie" value="'+t+'" /><param name="wmode" value="transparent" /><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="menu" value="false" /><embed src="'+t+'" type="application/x-shockwave-flash" allowscriptaccess="always" menu="false" wmode="transparent" allowfullscreen="true" width="'+a[1]+'" height="'+a[2]+'"></embed></object>';div_reg.piroFadeIn(300,function(){e(s).appendTo(div_reg),piro_loader.hide()});break;case"gallery":div_reg.css("overflow","hidden"),resize.css("overflow","hidden"),e(".my_frame").remove(),d();break;case"single":e(".my_frame").remove(),div_reg.html("").css("overflow","hidden"),resize.css("overflow","hidden"),d()}}var r=e(this).attr("title"),a=e(this).attr("rel").split("-"),t=e(this).attr("href");e(this).unbind(),e(this).bind("click",function(r){piro_bg.css({opacity:i.bg_alpha}),r.preventDefault(),piro_next.add(piro_prev).hide().css("visibility","hidden"),e(p).filter(".item").removeClass("item"),e(this).addClass("item"),o(),e(this).is(".first")?(piro_prev.hide(),piro_next.show(),piro_prev_fake.show().css({visibility:"hidden"})):(piro_next.add(piro_prev).show(),piro_next_fake.add(piro_prev_fake).hide()),e(this).is(".last")&&(piro_prev.show(),piro_next_fake.show().css({visibility:"hidden"}),piro_next.hide()),(e(this).is(".pirobox")||e(this).is(".single_fix"))&&piro_next.add(piro_prev).hide(),e(this).is(".last")&&e(this).is(".first")&&piro_next.add(piro_prev).hide()})}),e(".immagine").live("click",function(){e(".caption").slideToggle(200)}),piro_close.add(piro_loader).add(piro_bg).bind("click",function(e){e.preventDefault(),r()})}}(jQuery);